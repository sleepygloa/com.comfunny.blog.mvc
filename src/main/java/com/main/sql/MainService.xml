<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MainService">

	<select id="mainBlogContent" resultType="hashmap">
		SELECT 
			IDX
		,	TITLE
		,	MAX(SUBJECT) AS SUBJECT
		,	(SELECT COUNT(DISTINCT(TITLE)) FROM TB_BLOG_M) AS TITLE_COUNT
		,	(SELECT COUNT(SUBJECT) FROM TB_BLOG_M) AS TOTAL_SUBJECT_COUNT
		,	(SELECT COUNT(SUBJECT) FROM TB_BLOG_M SUB WHERE SUB.TITLE = M.TITLE) AS SUBJECT_COUNT
		FROM
			TB_BLOG_M M
		GROUP BY IDX, TITLE;
	</select>

	<select id="getBlogAddDropdownList" resultType="hashmap">
		SELECT 
			TITLE
		FROM
			TB_BLOG_M M
		GROUP BY TITLE;
	</select>
	
	<insert id="insertBlogAddContent" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
		<selectKey keyProperty="IDX" resultType="string" order="BEFORE">
			SELECT IF( IFNULL(MAX(IDX), 0) = 0, 1, MAX(IDX)+1) FROM TB_BLOG_M
		</selectKey>
		INSERT INTO TB_BLOG_M
		(
			IDX
		,	TITLE
		,	SUBJECT
		,	CONTENT
		)
		VALUES
		(
			#{IDX}
		,	#{title}
		,	#{subject}
		,	#{content}
		);
	</insert>

	<select id="viewBlogContent" parameterType="hashmap" resultType="hashmap">
		SELECT
			*
		FROM
			TB_BLOG_M
		WHERE
			IDX		= #{idx};
	</select> 

</mapper>